# Codex CLI 仕様駆動開発 実践ガイド

このドキュメントでは、動画「【Codex CLI対応】仕様駆動開発を1コマンドで導入！Spec Driven Codexで要件定義→設計→実装まで完全自動化」（再生時間 24:56、公開日 2025-09-26）で紹介されたワークフローを、実務で再現するための手順として整理します。ゼロからのセットアップに加え、各プロンプトで得られる成果物の扱い方やチーム連携時の注意点をまとめました。

## 1. 前提条件
- Codex CLI がローカルにインストール済みであること。
- プロジェクトルートには Git リポジトリがあり、`npm run build` が利用可能であること。
- 仕様駆動開発の成果を保存するために `.sdd/` ディレクトリをコミット対象に含めます。

## 2. 初期セットアップ（動画 01:45〜）
1. プロジェクトルートで以下を実行し、日本語テンプレートを導入します。
   ```bash
   npx spec-driven-codex init --locale ja
   ```
2. 既存プロンプトを最新化したい場合は次を使用します。
   ```bash
   npx spec-driven-codex upgrade --locale ja
   ```
3. コマンド実行後、`.sdd/` 配下と `~/.codex/prompts/` にテンプレートが展開されます。変更内容は必ず `git status` で確認してください。

## 3. プロジェクト理解と情報の棚卸し（03:39〜）
- `codex` を起動し、`/sdd-steering` を実行します。動画では既存プロジェクトの技術スタックやディレクトリ構造を約3分で整理していました。
- 出力された `product.md`、`tech.md`、`structure.md` をレビューし、足りない情報があれば追記してからコミットします。
- 大きな方針転換や依存ライブラリの更新があるたびに再実行し、最新状態を保ちます。

## 4. 課題と目的の定義（06:46〜）
- `.sdd/description.md` に現状の課題、目指すゴール、制約条件をテキストで整理します。
- 動画では「トップページ新設」を例に、既存機能との整合性や要件定義の前提を追記していました。書き換えた内容は必ずコミットメッセージに残しましょう。

## 5. 要件定義（08:31〜）
1. `/sdd-requirements` を実行し、受け入れ条件を含む要件書を生成します。
2. 生成物は `.sdd/specs/<spec-name>/requirements.md` に保存されます。チームレビューでコメントを集め、必要なら再実行して整合を取ります。
3. 実装前に受け入れ条件をチームと共有し、JIRA や GitHub Issues にリンクさせるとトレーサビリティが向上します。

## 6. 詳細設計（11:18〜）
- `/sdd-design` を実行してアーキテクチャ方針を整理します。React や Next.js のコンポーネント構造、API 連携、テストポリシーなどを明文化します。
- 動画デモでは主要コンポーネントの責務や、既存コードとの接続ポイントが自動生成されていました。必要に応じて補足コメントを追記してください。
- 詳細設計が不要であれば `/sdd-highway` を利用し、設計〜実装準備を一気に進められます（14:03〜）。

## 7. タスク分解（14:03〜）
1. `/sdd-tasks` を実行すると、チェックリスト形式のタスク群が `.sdd/specs/<spec-name>/tasks.md` に生成されます。
2. タスクごとに担当者、完了条件、関連コミットをメモ欄に追記します。
3. チーム開発ではタスクIDを Issue 番号と合わせて記載し、進捗を `git commit` の本文で紐づけると管理が容易です。

## 8. 実装と検証（16:25〜）
- `/sdd-implement` を起動すると、タスクを順番に処理するプロンプトが表示されます。ステップごとにCodex CLIが差分を確認し、必要なコマンドを提案します。
- 動画では React コンポーネントを追加しながら、テストやリファクタリングを組み込む様子が紹介されました。プロンプトが停止したら `ok` や `skip` を入力して進行を制御します。
- 実装中は以下のチェックポイントを守ります。
  - 主要タスク完了ごとに `npm run build` でビルド確認。
  - UI 変更は `npm run dev` で動作を確認し、スクリーンショットを PR に添付。
  - 自動生成されたコードでもリント・フォーマットを手動で適用。

## 9. アーカイブと振り返り（20:40〜）
1. 実装完了後は `/sdd-archive` を実行し、成果と学びを日付付きフォルダに保存します。
2. アーカイブ内容（例: `2025-10-05-landing-page/summary.md`）には、対応した課題、採用したアプローチ、検証結果を記載します。
3. 後続チームへの共有として、`docs/` 配下に抜粋を転記し、`.vitepress/config.js` のサイドバーにリンクを追加すると再利用性が高まります。

## 10. チーム連携のポイント
- プロンプトを実行すると Codex CLI が計画を表示して入力待ちになる場合があります。合意形成のために、全員が内容を確認してから `ok` を入力してください。
- `.sdd/` の変更はコミット単位で管理し、Conventional Commits（例: `docs: document sdd archive for landing page`）を徹底します。
- 重要な決定事項は `tasks.md` や `summary.md` に追記し、後日参照できるようにします。

## 11. トラブルシューティング
| 状況 | 対応策 |
| --- | --- |
| プロンプトが途中で停止する | CLI のメッセージを確認し、`ok` で承認、`skip` でスキップ。再実行時は最新差分を反映させてから続行。 |
| テンプレートが古くなった | `npx spec-driven-codex upgrade --locale ja` で更新し、`/sdd-steering` と `/sdd-archive` を再実行して整合性を確認。 |
| 途中で別の spec を扱いたい | `.sdd/target-spec.txt` に対象スペック名を記入し、`/sdd-requirements` から再開。 |
| アーカイブが肥大化した | `archives/` を定期的に確認し、不要なスペックは `git tag` や Wiki へ移行して履歴を整理。 |

## 12. 参考リンク
- YouTube: [【Codex CLI対応】仕様駆動開発を1コマンドで導入！Spec Driven Codexで要件定義→設計→実装まで完全自動化](https://youtu.be/1EQllS_3TJo?si=TtT7LlsuplMFP4UF)
- Qiita: [〖Codex CLI対応〗仕様駆動開発ツール「Spec Driven Codex」を公開しました！](https://qiita.com/tomada/items/781d6eb5b79e5873d9ab)
- GitHub: [tomada1114/spec-driven-codex](https://github.com/tomada1114/spec-driven-codex)

このガイドに沿って Codex CLI のワークフローを運用すれば、要件定義から実装・振り返りまでを一貫した仕様駆動開発として進められます。チームのコンテキストに合わせてカスタマイズしつつ、`.sdd/` の成果を継続的に活用してください。



